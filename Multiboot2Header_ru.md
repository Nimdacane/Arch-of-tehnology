# Спецификая Multiboot2. Заголовок исполняемого файла
> [!WARNING]
> ВНИМАНИЕ! 
> 1. Если вы видите в описании ***Потом***, свяжитесь с создателем который забыл сделать описание
> 2. Данная документация состоит из *"Устаревших"* данных - новые части заголовка **пока что** проигнорированны(например новые архитектуры EFI x86_64(amd64) в поле Architecture по смещению 4(ведь тег EFI AMD64 Entry Point указан в документации) и подобные части/теги/спецификации) 
> *(Но надо учесть что не добавлены только новые параметры/теги, сама структура заголовка не подверженна измениям)*

### Главный заголовок
| Смещение             | Тип   | Имя           | Примечание   | Значение          | Описание                                                                                                                                |
|----------------------|-------|---------------|--------------|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| 0                    |  u32  | MAGIC         | обязательный | 0xE85250D6        | Индентификатор заголовка Multiboot2, всегда 0xE85250D6                                                                                  |
| 4                    |  u32  | Architecture  | обязательный | 0                 | Архитектура набора команд центрального процессора, поскольку magic не палиндром - направление байт (LE/BE) не указывается в архитектуре |
| 8                    |  u32  | Header length | обязательный | (Всегда разное)   | Указывается длина заголовка Multiboot2 в байтах, включая магические поля.                                                               |
| 12                   |  u32  | Checksum      | обязательный | (Всегда разное)   | Проверочная сумма(CRC32), которая при сумме со значениями MAGIC, Architecture и Header length дает 32-х битный ноль                     |
| 16-XX                | [Tag] | Tags...       | обязательный | Массив            | Теги Multiboot2                                                                                                                         |
| XX-КонецЗаголовка    | Tag   | 0/8 тег       | обязательный | (0/8 тег)         | Тег Multiboot2, имеющий тип 0 и размер 8, закрывает все теги                                                                            |

---
## Таблицы

### Типы
| Название | Количество бит | Количество байт | Знаковость | Примечание     |
|----------|----------------|-----------------|------------|----------------|
| u8       | 8              | 1               | нет знака  |                |
| u16      | 16             | 2               | нет знака  |                | 
| u32      | 32             | 4               | нет знака  |                |
| u64      | 64             | 8               | нет знака  |                |
| Tag      | >8             | >1              | нет знака  | Тег Multiboot2 |

---
### Заголовок тега
Такой заголовок имеет каждый тег в начале
| Тип | Имя           | Значение                   | Описание    |
|-----|---------------|----------------------------|-------------|
| u16 | Type          | 0-10                       | Тип тега    |
| u16 | Flags         | (2 байта побитовых флагов) | Флаги тега. "Если установлен бит «0» (также известном как «optional»), загрузчик может проигнорировать этот тег, если он не поддерживается"       |
| u32 | Size          | (4 байта размера тега)     | Размер тега                   |
|     | Data          | (Остальные данные тега)    | Данные тега, заканчивающиеся по достижению размера тега |

---
### Теги
> [!WARNING] 
> Примечание!
> Все указанные ниже теги будут подробно рассмотрены ниже

| Тег | ID типа | Описание |
|--|--|--|
| [Information Request Tag](#) | 1 | Тег, для запрашивания данных от Mutliboot2-совместимого загрузчика |
| [Multiboot2 Address Tag](#) | 2 | Settings тег, который задает физические адреса загрузки Multiboot2-совместимого приложения/ОС/ядра |
| [Multiboot2 Entry Address Tag](#) | 3 | Settings тег, задающий физический адрес на который должен грузиться Multiboot2-совместимый загрузчик |
| [Flags Tag](#) | 4 | Тег, который задает "Консольные флаги". Имеет фиксированный размер 12 |
| [Framebuffer Tag](#) | 5 | Settings тег, который задает ***предпочтительный*** графический режим *буффера кадров*(framebuffer). Имеет фиксированный размер 20 |
| [Module Alligment Tag](#) | 6 | Тег, требующий выровнять модули по странице. Имеет фиксированный размер 8 |
| [EFI Boot Services Tag](#) | 7 | Settings тег, указывающий на то что ОС/приложение/ядро поддерживает запуск без выхода из EFI Boot Services. Имеет фиксированный размер 8 |
| [Multiboot2 EFI i386 Entry Address Tag](#) | 8 | Settings тег, задающий физический адрес на который должен грузиться Multiboot2-совместимый загрузчик при архитектуре *UEFI/EFI **i386*** |
| [Multiboot2 EFI amd64 Entry Address Tag](#) | 9 | Settings тег, задающий физический адрес на который должен грузиться Multiboot2-совместимый загрузчик при архитектуре *UEFI/EFI **amd64*** |
| [Relocatable Tag](#) | 10 | Тег, указывающий на возможность перемещения образа ОС/ядра/приложения. Имеет фиксированный размер 24|
| [End Tag](#) | 0 | Тег, закрывающий массив тегов Multiboot2. Имеет фиксированный размер 8 |

> *Settings тег - тег, настраивающий загрузку ОС/ядра/приложения*

---
## Ресурсы
[Официальная документация GNU GRUB](https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html)
